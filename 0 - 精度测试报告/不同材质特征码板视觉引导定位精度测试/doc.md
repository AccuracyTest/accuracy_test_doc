# 不同材质特征码板视觉引导定位精度测试报告

Version June 26, 2023

## 简介

​	特征码板指印有规定Aruco二维码阵列的标志物。在使用AuboVision 视觉系统时，特征码板的材质因为在成像是否清晰、Aruco二维码边缘是否锐利、表面是否反光、图案打印精度等方面存在差异，最终会影响特征码定位的引导精度与识别稳定性。

​	本工作中，在使用不同材质的特征码板的情况下，对AuboVision视觉系统的特征码定位功能进行定位精度测试，以验证不同材质的特征码板对视觉引导性能的影响。在本工作中，共使用三种不同材质的特征码板：氧化铝表面层+ 铝基板、哑光白菲林表面层+铝基板、 PVC。

## 测试设备介绍

### 测试硬件设备组成

​	测试设备为遨博二合一视觉机器人Aubo-i5-V-2in1，其组成部分包括Aubo-i5 六关节协作机械臂，2D工业面阵相机，相机光源以及遨博二合一控制柜。

​	2D 视觉相机通过相机支架安装于机械臂末端法兰，型号为 MV-CS060-11GM，使用千兆网口与机器人控制器通信，使用 24V 直流供电。

​	此外机械臂末端法兰安装有 Aruco 二维码支架，支架上粘贴单个标准 Aruco 二维码，在测试过程中，先使用 AuboVison 视觉插件进行视觉引导，机械臂携带二维码运动至 3D 相机扫描范围内，由 3D 相机进行点云获取。

<div>
    <center>
        <img src="D:\AuBo\标品 - 视觉机器人标品\0 - 特征码板量产导入\测试 - 特征码板测试\研发测试报告\Figs\机械臂法兰末端组件实物图.png" alt="机械臂法兰末端组件实物图" style="zoom: 50%;"/>
        <br>
        Fig 1. 机械臂法兰末端组件实物图
    </center>
</div>

​	在测试场景中，布置有一台 3D 相机，型号为 PhoXi 3D Scanner L，固定在由型材搭建的相机支架上，其工作内容为获取点云数据。

<div>
    <center>
        <img src="D:\AuBo\标品 - 视觉机器人标品\0 - 特征码板量产导入\测试 - 特征码板测试\研发测试报告\Figs\3D相机实物图.png" alt="image-20230626150216042" style="zoom:20%;" />
        <br>
        Fig 2.  3D 相机实物图
    </center>
</div>

​	在测试场景中，布置有一台数据处理工控机，指一台上位机，上位机使用 ubuntu 系统，工作内容为启动 3D 相机扫描点云，以及点云数据的处理和位姿数据存储。

​	测试过程中，使用三种材质的特征码板进行定位精度测试，实物图如下：

<div>
    <center>
        <img src="D:\AuBo\标品 - 视觉机器人标品\0 - 特征码板量产导入\测试 - 特征码板测试\研发测试报告\Figs\氧化铝.jpg" alt="氧化铝" style="zoom:30%;" />
        <img src="D:\AuBo\标品 - 视觉机器人标品\0 - 特征码板量产导入\测试 - 特征码板测试\研发测试报告\Figs\菲林.jpg" alt="菲林" style="zoom:30%;" />
        <img src="D:\AuBo\标品 - 视觉机器人标品\0 - 特征码板量产导入\测试 - 特征码板测试\研发测试报告\Figs\PVC.jpg" alt="pvc" style="zoom:23%;" />
        <br>
        Fig 3.  特征码板 - 氧化铝表面 + 铝基板（左）， 哑光白菲林 + 铝基板（中），PVC（右）

### 测试软件

#### AuboVision视觉插件

​	在测试过程中使用 Aubovision 插件，插件运行于视觉机器人控制器中，其功能包括初始化/断开设备、模板匹配定位、特征码定位、相机标定、相机配置以及机械臂示教。

<div>
    <center>
        <img src="D:\AuBo\标品 - 视觉机器人标品\0 - 特征码板量产导入\测试 - 特征码板测试\研发测试报告\Figs\AuboVision插件.png" alt="image-20230626170922574" style="zoom:50%;" />
        <br>
        Fig 4.  AuboVision插件界面
    </center>
</div>

​	在测试过程中，首先使用标定板完成相机手眼标定，完成标定后选择模板定位或特征码定位功能，按操作步骤说明进行模板制作、视觉引导路点添加、生成脚本。等待脚本生成结束，在示教器在线编程工程中调用插件生成的对应脚本。

#### 上位机软件

​	在测试过程中使用一个上位机软件，其功能包括获取可用的设备名称、连接/断开设备、启动 3D 相机扫描点云、扫描图像显示、Aruco 二维码识别并计算其位置姿态以及数据存储。

<div>
    <center>
        <img src="D:\AuBo\标品 - 视觉机器人标品\0 - 特征码板量产导入\测试 - 特征码板测试\研发测试报告\Figs\上位机.png" alt="image-20230626171645754" style="zoom:40%;" />
        <br>
        Fig 5.  上位机软件界面
    </center>
</div>

## 测试方案

### 测试流程	

​	在本工作中，分别使用三种不同材质的特征码分别进行特征码定位测试。在每轮测试中，特征码板固定在测试台面上，机械臂首先运动至拍照位对特征码进行拍照，根据拍照结果引导机械臂携带二维码板运动至测量路点，触发3D相机进行扫描、计算位姿、存储数据。

<div>
    <center>
        <img src="D:\AuBo\标品 - 视觉机器人标品\0 - 特征码板量产导入\测试 - 特征码板测试\研发测试报告\Figs\特征码测试场景.png" alt="image-20230626174056870" style="zoom: 70%;" />
        <br>
        Fig 6.  特征码测试场景
    </center>
</div>

### 数据分析

​	通过上述测试方案，每轮测试可以获得机械臂末端携带二维码的位姿数据。其中二维码位置精度由每次测量出的二维码坐标系原点在相机坐标系下的坐标 $(x_{measured}, y_{measured}, z_{measured})$ 与示教位的二维码坐标系原点在相机坐标系下的坐标$(x_{teach},y_{teach},z_{teach})$之间的欧氏距离描述，姿态精度由每次测量出的二维码坐标系的 x 轴与示教位的二维码坐标系 x 轴的向量夹角描述。

#### 位置精度分析

​	对于每组测试数据进行归一化处理，即减去示教点位的测量数据，目的是去除系统误差、环境噪声等因素。
$$
x_{normalized} = x_{measured} - x_{teach}	\\
y_{normalized} = y_{measured} - y_{teach}	\\
z_{normalized} = z_{measured} - z_{teach}	\\
$$
​	使用归一化处理后的数据计算点 $(x_i, y_i, z_i)$, 其中$x_i \in x_{normalized}, y_i \in y_{normalized}, z_i \in z_{normalized}$，到示教点位的欧氏距离：
$$
Euclidean Distance = \sqrt{x_i^2 + y_i^2 + z_i^2}
$$
所有点距离示教点位的欧式距离的平均值为$\mu_{pos}[mm]$，标准差为$\sigma_{pos}[mm]$，视觉引导的位置绝对误差$ϵ_{pos}[mm] $定义为:
$$
ϵ_{pos} \in [\mu_{pos} - 3\sigma_{pos}, \mu_{pos} + 3\sigma_{pos}]
$$

#### 姿态精度分析

​	对于每一组测试，计算二维码坐标系 x 轴与示教位的二维码坐标系 x 轴的向量夹角。
$$
\cos(\ang(\vec{x}_{teach}, \vec{x}_{measured})) = \frac{\vec{x}_{teach} \cdot \vec{x}_{measured}}{|\vec{x}_{teach}||\vec{x}_{measured}|}
$$

$$
\Rightarrow \ \ang(\vec{x}_{teach}, \vec{x}_{measured}) = \arccos(\frac{\vec{x}_{teach} \cdot \vec{x}_{measured}}{|\vec{x}_{teach}||\vec{x}_{measured}|})
$$

平均向量夹角值为$\mu_{ort}[deg]$，标准差为$\sigma_{ori}[deg]$, 视觉引导的姿态绝对误差$\epsilon_{ori}[deg]$描述定义为:
$$
\epsilon_{ori} \in [\mu_{ori} - 3\sigma_{ori}, \mu_{ori} + 3\sigma_{ori}][deg]
$$

## 测试结果

​	在本工作中使用三种不同材质的特征码板进行定位精度测试。 对于每一种特征码板进行50轮测量，统计特征码识别率、视觉引导成功率以及视觉引导定位精度。

### 氧化铝表面 +  铝基板

​	50轮测试中未出现识别失败的情况，平均Aruco二维码识别个数为35。	

​	以$3\sigma$ 范围为准，定位精度统计如下：

|          | 绝对定位精度           | 重复定位精度          |
| -------- | ---------------------- | --------------------- |
| 位置精度 | $[-0.796, 1.268]$[mm]  | $[-1, 1]$[mm]         |
| 角度精度 | $[-0.024, 1.134]$[deg] | $[-0.579,0.579]$[deg] |

<div>
    <center>
        <img src="D:\AuBo\标品 - 视觉机器人标品\0 - 特征码板量产导入\测试 - 特征码板测试\研发测试报告\Figs\氧化铝表面+铝基板-定位精度测试结果.png" alt="氧化铝表面+铝基板-定位精度测试结果" style="zoom: 50%;" />
        <br>
        Fig 7. 氧化铝表面+铝基板-位置定位精度测试结果
    </center>
</div>

<div>
    <center>
        <img src="D:\AuBo\标品 - 视觉机器人标品\0 - 特征码板量产导入\测试 - 特征码板测试\研发测试报告\Figs\氧化铝表面+铝基板-姿态定位精度测试结果-向量夹角法.png" alt="氧化铝表面+铝基板-姿态定位精度测试结果-向量夹角法" style="zoom: 60%;" />
        <br>
        Fig 8. 氧化铝表面+铝基板-姿态定位精度测试结果
    </center>
</div>

### 哑光白菲林表面 + 铝基板

​	50轮测试中出现1次识别失败的情况，平均Aruco二维码识别个数为35。

​	以$3\sigma$ 范围为准，定位精度统计如下：

|          | 绝对定位精度           | 重复定位精度        |
| -------- | ---------------------- | ------------------- |
| 位置精度 | $[-0.53,2.71]$[mm]     | $[-1.62, 1.62]$[mm] |
| 角度精度 | $[-0.346, 0.794]$[deg] | $[-0.57,0.57]$[deg] |

<div>
    <center>
        <img src="D:\AuBo\标品 - 视觉机器人标品\0 - 特征码板量产导入\测试 - 特征码板测试\研发测试报告\Figs\哑光白菲林表面+铝基板-位置定位精度测试结果.png" alt="哑光白菲林表面+铝基板-位置定位精度测试结果" style="zoom: 50%;" />
        <br>
        Fig 9. 哑光白菲林表面+铝基板-位置定位精度测试结果
    </center>
</div>

<div>
    <center>
        <img src="D:\AuBo\标品 - 视觉机器人标品\0 - 特征码板量产导入\测试 - 特征码板测试\研发测试报告\Figs\哑光白菲林表面+铝基板-姿态定位精度测试结果-向量夹角法.png" alt="哑光白菲林表面+铝基板-姿态定位精度测试结果-向量夹角法" style="zoom: 60%;" />
        <br>
        Fig 10. 哑光白菲林表面+铝基板-姿态定位精度测试结果
    </center>
</div>

### PVC

​	50轮测试中出现2次识别失败的情况，平均Aruco二维码识别个数为22。

​	以$3\sigma$ 范围为准，定位精度统计如下：

|          | 绝对定位精度           | 重复定位精度          |
| -------- | ---------------------- | --------------------- |
| 位置精度 | $[0.108,4.416]$[mm]    | $[-2.154, 2.154]$[mm] |
| 角度精度 | $[-0.115, 1.085]$[deg] | $[-0.6,0.6]$[deg]     |

<div>
    <center>
        <img src="D:\AuBo\标品 - 视觉机器人标品\0 - 特征码板量产导入\测试 - 特征码板测试\研发测试报告\Figs\PVC-位置定位精度测试结果.png" alt="PVC-位置定位精度测试结果" style="zoom: 50%;" />
        <br>
        Fig 11. 哑光白菲林表面+铝基板-位置定位精度测试结果
    </center>
</div>

<div>
    <center>
        <img src="D:\AuBo\标品 - 视觉机器人标品\0 - 特征码板量产导入\测试 - 特征码板测试\研发测试报告\Figs\PVC+铝基板-姿态定位精度测试结果-向量夹角法.png" alt="PVC+铝基板-姿态定位精度测试结果-向量夹角法" style="zoom: 60%;" />
        <br>
        Fig 12. PVC+铝基板-姿态定位精度测试结果
    </center>
</div>

## 测试结果总结

​	由上述结果可得出，使用氧化铝+ 铝基板材质的特征码板进行视觉引导，识别成功率高、Aruco二维码识别数量多，并且可以保证良好的视觉引导定位精度与稳定性。

​	哑光白菲林+铝基板的特征码板可以保证较高的识别成功率与Aruco二维码识别数量，但由于哑光白菲林表面存在保护层，对最终成像存在一定影响。

​	PVC材质的特征码板成本低，但由于其印刷精度低、表面易磨损、表面易反光导致识别成功率低、Aruco二维码识别数量少，最终降低了视觉引导的定位精度与稳定性。